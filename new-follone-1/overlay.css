/* follone overlay UI - latte CRT + character accent (token-driven, layered) */

/* DotGothic16 (Google Fonts). If blocked by CSP, we fall back to monospace/system. */
@import url('https://fonts.googleapis.com/css2?family=DotGothic16&display=swap');

#follone-widget{
  /* ---- Tokens (base) ---- */
  /* yume-kawa cream / lavender white */
  --ui-body-0: #FFFFFF;
  --ui-body-1: #F7F5FF;
  --ui-body-2: #F1ECFF;
  --ui-ink-0: #3A3142;
  --ui-ink-1: #5A4F66;
  --ui-ink-2: #7A6D8A;
  --ui-line: rgba(58,49,66,0.14);

  /* Accent (overridden by data-skin) */
  --ui-accent: #7B61FF;
  --ui-accent-soft: rgba(123,97,255,0.35);
  --ui-accent-glow: rgba(123,97,255,0.22);

  /* Shadows / depth */
  --shadow-outer: 0 10px 30px rgba(0,0,0,0.08);
  --shadow-inset-1: inset 0 2px 2px rgba(255,255,255,0.65);
  --shadow-inset-2: inset 0 -3px 6px rgba(0,0,0,0.12);
  --bevel: inset 0 1px 0 rgba(255,255,255,0.55), inset 0 -1px 0 rgba(0,0,0,0.10);

  /* Glass strengths (yume-kawa / transparent) */
  --glass-opacity: 0.42;
  --glass-reflect: 0.22;
  /* retro CRT textures are disabled (no scanlines / no dot noise) */
  --glass-scanline: 0;
  --glass-noise: 0;

  /* Typography (dot-ish) */
  --font-dot-ui: "DotGothic16", "Dot Gothic 16", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  --font-dot-ticker: "DotGothic16", "Dot Gothic 16", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  --fs-ui: 11px;
  --fs-ticker-top: 12px;
  --fs-ticker-bottom: 10.5px;
  --lh-dot: 1.45;
  --letter-dot: 0.08em;

  /* Motion */
  --t-fast: 120ms;
  --t-mid: 220ms;
  --t-slow: 420ms;
  --delay-1: 0ms;
  --delay-2: 80ms;
  --delay-3: 160ms;
  --ease-out: cubic-bezier(.16,1,.3,1);
  --ease-soft: cubic-bezier(.2,.8,.2,1);

  position: fixed;
  right: 18px;
  bottom: 18px;
  z-index: 2147483647;
  width: 344px;
  color: var(--ui-ink-0);
  font-family: "DotGothic16", "Dot Gothic 16", system-ui, -apple-system, "Segoe UI", "Hiragino Sans", "Noto Sans JP", sans-serif;
  -webkit-font-smoothing: antialiased;
}

/* Skin mapping */
#follone-widget[data-skin="forone"]{
  --ui-accent: #7B61FF;
  --ui-accent-soft: rgba(123,97,255,0.35);
  --ui-accent-glow: rgba(123,97,255,0.22);
}
#follone-widget[data-skin="likoris"]{
  --ui-accent: #FD6B98;
  --ui-accent-soft: rgba(253,107,152,0.35);
  --ui-accent-glow: rgba(253,107,152,0.22);
}

#follone-widget *{ box-sizing: border-box; }

/* ---- Device shell ---- */
#follone-widget .device{ position: relative; }

#follone-widget .deviceBody{
  position: relative;
  border-radius: 20px;
  background: linear-gradient(180deg, var(--ui-body-0), var(--ui-body-1));
  box-shadow: var(--shadow-outer);
  border: 1px solid rgba(42,39,35,0.10);
  overflow: hidden;
}

/* Inset screen area (embedded) */
#follone-widget .deviceInset{
  position: relative;
  padding: 12px;
  border-radius: 18px;
  margin: 10px;
  background: rgba(255,255,255,0.48);
  border: 1px solid rgba(42,39,35,0.10);
  box-shadow: var(--shadow-inset-1), var(--shadow-inset-2);
  backdrop-filter: blur(6px);
}

/* Glass layer (CRT) */
#follone-widget .glassLayer{
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: var(--glass-opacity);
  /* yume-kawa glass: soft bokeh + a tiny sparkle hint (no CRT scanlines) */
  background:
    radial-gradient(260px 180px at 18% 6%, rgba(255,255,255,var(--glass-reflect)), transparent 70%),
    radial-gradient(280px 220px at 92% 8%, rgba(255,255,255,calc(var(--glass-reflect) * 0.85)), transparent 74%),
    radial-gradient(220px 160px at 35% 92%, rgba(123,97,255,0.10), transparent 72%),
    radial-gradient(240px 160px at 82% 82%, rgba(253,107,152,0.10), transparent 72%);
}

/* Sparkle dust (very subtle) */
#follone-widget .glassLayer::after{
  content:"";
  position:absolute; inset:0;
  opacity: 0.18;
  background:
    radial-gradient(rgba(255,255,255,0.9) 1px, transparent 2px);
  background-size: 38px 38px;
  background-position: 0 0;
  filter: blur(0.2px);
}

/* Accent FX */
#follone-widget .fxLayer{
  position:absolute; inset:0;
  pointer-events:none;
  background:
    radial-gradient(260px 160px at 26% 6%, var(--ui-accent-glow), transparent 60%),
    radial-gradient(260px 160px at 74% 0%, rgba(255,255,255,0.18), transparent 65%);
  opacity: 0.55;
  mix-blend-mode: screen;
}

/* ---- Stage ---- */
#follone-widget .stage{
  display: grid;
  grid-template-columns: 96px 1fr;
  gap: 12px;
  align-items: center;
  padding: 8px;
  border-radius: 16px;
  background: rgba(255,255,255,0.45);
  border: 1px solid rgba(42,39,35,0.10);
  box-shadow: var(--bevel);
}

#follone-widget .petWrap{ position: relative; }
#follone-widget .avatar{
  width: 88px;
  height: 88px;
  border-radius: 18px;
  background: rgba(255,255,255,0.55);
  border: 1px solid rgba(42,39,35,0.10);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.75);
  overflow:hidden;
}

/* subtle floor shadow under pet */
#follone-widget .petWrap::after{
  content:"";
  position:absolute;
  left: 12px;
  right: 12px;
  bottom: -6px;
  height: 14px;
  border-radius: 999px;
  background: radial-gradient(closest-side, rgba(0,0,0,0.12), transparent 70%);
  opacity: 0.55;
  filter: blur(0.2px);
}

#follone-widget .stageMeta{ min-width:0; }
#follone-widget .name{
  font-weight: 900;
  letter-spacing: 0.2px;
  font-size: 14px;
  line-height: 1.1;
}
#follone-widget .state{
  margin-top: 4px;
  color: var(--ui-ink-2);
  font-size: 11px;
  letter-spacing: 0.2px;
}

#follone-widget .miniRow{ display:flex; gap: 8px; margin-top: 8px; }
#follone-widget button{ font-family: inherit; }
#follone-widget .miniBtn{
  border-radius: 14px;
  border: 1px solid rgba(42,39,35,0.12);
  background: rgba(255,255,255,0.62);
  color: var(--ui-ink-0);
  padding: 7px 10px;
  font-size: 12px;
  font-weight: 900;
  cursor:pointer;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.80);
  transition: transform var(--t-fast) var(--ease-out), filter var(--t-fast) var(--ease-out);
}
#follone-widget .miniBtn:hover{ filter: brightness(1.03); transform: translateY(-1px); }
#follone-widget .miniBtn:active{ transform: translateY(0px); }

/* -----------------------------
   Minimize mode (avatar-only)
   ----------------------------- */
#follone-widget .petWrap{ position:relative; }
#follone-widget .restoreBtn{
  display:none;
  align-items:center;
  justify-content:center;
  position:absolute;
  right:-6px;
  bottom:-6px;
  min-width: 46px;
  height: 28px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid rgba(42,39,35,0.12);
  background: rgba(255,255,255,0.72);
  color: var(--ui-ink-0);
  font-weight: 900;
  font-size: 12px;
  cursor:pointer;
  box-shadow: 0 10px 24px rgba(0,0,0,0.10), inset 0 1px 0 rgba(255,255,255,0.85);
}

#follone-widget.minimized .restoreBtn{ display:flex; }
#follone-widget.minimized .stageMeta,
#follone-widget.minimized .meters,
#follone-widget.minimized .ticker,
#follone-widget.minimized .actions,
#follone-widget.minimized .muted,
#follone-widget.minimized .quests{ display:none !important; }

#follone-widget.minimized{
  width: 150px;
  right: 18px;
  bottom: 18px;
}
#follone-widget.minimized .deviceInset{ padding: 14px 14px 12px; }
#follone-widget.minimized .stage{ justify-content:center; }

/* ---- Meters ---- */
#follone-widget .meters{
  margin-top: 10px;
  padding: 10px 10px 10px;
  border-radius: 16px;
  background: rgba(255,255,255,0.45);
  border: 1px solid rgba(42,39,35,0.10);
  box-shadow: var(--bevel);
}

#follone-widget .meterRow{ display:flex; align-items:center; gap: 8px; padding: 5px 2px; }

#follone-widget .meterIcon{
  width: 18px;
  text-align:center;
  font-family: var(--font-dot-ui);
  font-size: 12px;
  color: rgba(42,39,35,0.55);
  user-select:none;
}

#follone-widget .meterTrack{
  position: relative;
  flex: 1;
  height: 12px;
  border-radius: 8px;
  background: rgba(42,39,35,0.06);
  border: 1px solid rgba(42,39,35,0.10);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.55);
  overflow: hidden;
}

/* Empty block pattern (■□□ style) */
#follone-widget .meterTrack::before{
  content:"";
  position:absolute;
  inset: 1px;
  border-radius: 6px;
  background:
    repeating-linear-gradient(90deg,
      rgba(42,39,35,0.18) 0px,
      rgba(42,39,35,0.18) 9px,
      rgba(0,0,0,0) 9px,
      rgba(0,0,0,0) 12px);
  opacity: 0.22;
  pointer-events:none;
}

#follone-widget .meterFill{
  height:100%;
  width:0%;
  position: relative;
  background:
    repeating-linear-gradient(90deg,
      rgba(42,39,35,0.10) 0px,
      rgba(42,39,35,0.10) 9px,
      rgba(0,0,0,0) 9px,
      rgba(0,0,0,0) 12px),
    linear-gradient(90deg, var(--ui-accent-soft), var(--ui-accent));
  transition: width var(--t-slow) var(--ease-soft);
}

/* Tip glow (accent only at the end) */
#follone-widget .meterFill::after{
  content:"";
  position:absolute;
  right: -8px;
  top: -6px;
  width: 18px;
  height: 22px;
  background: radial-gradient(closest-side, var(--ui-accent-glow), transparent 70%);
  opacity: 0.85;
  pointer-events:none;
}

/* Boot sequence: meters light up with a left-to-right sweep */
#follone-widget.booting .meterFill{
  transform-origin: left;
  animation: folloneBootSweep 620ms var(--ease-out) both;
}
#follone-widget.booting .meterRow:nth-child(1) .meterFill{ animation-delay: 80ms; }
#follone-widget.booting .meterRow:nth-child(2) .meterFill{ animation-delay: 140ms; }
#follone-widget.booting .meterRow:nth-child(3) .meterFill{ animation-delay: 200ms; }

@keyframes folloneBootSweep{
  0%{ transform: scaleX(0.08); filter: brightness(1.25) saturate(1.1); }
  70%{ transform: scaleX(1.0); filter: brightness(1.05) saturate(1.0); }
  100%{ transform: scaleX(1.0); filter: none; }
}

#follone-widget .meterVal{
  width: 44px;
  text-align:right;
  font-family: var(--font-dot-ui);
  font-size: var(--fs-ui);
  letter-spacing: 0.02em;
  font-variant-numeric: tabular-nums;
  color: rgba(42,39,35,0.62);
  opacity: 0;
  transition: opacity var(--t-mid) var(--ease-out);
}

/* show numbers on hover (keeps overlay clean) */
#follone-widget .meters:hover .meterVal{ opacity: 1; }

/* keep these for logic but hide by default */
#follone-widget .dashInfo{ display:none; }

/* ---- Ticker (dot board) ---- */
#follone-widget #follone-taskbar.ticker{
  margin-top: 10px;
  border-radius: 16px;
  border: 1px solid rgba(42,39,35,0.12);
  background: rgba(255,255,255,0.42);
  box-shadow: var(--bevel);
  padding: 8px 10px 9px;
  overflow:hidden;
  position: relative;
}

/* yume-kawa substrate (no dot-matrix / no CRT) */
#follone-widget #follone-taskbar.ticker::before{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(220px 120px at 18% 18%, rgba(255,255,255,0.65), transparent 70%),
    radial-gradient(240px 140px at 78% 10%, rgba(255,255,255,0.55), transparent 72%),
    radial-gradient(200px 120px at 40% 90%, rgba(123,97,255,0.12), transparent 72%),
    radial-gradient(240px 140px at 88% 78%, rgba(253,107,152,0.12), transparent 74%);
  opacity: 0.85;
  pointer-events:none;
}

#follone-widget #follone-taskbar.ticker::after{
  content:"";
  position:absolute; inset:-2px;
  background: radial-gradient(240px 120px at 24% 0%, var(--ui-accent-glow), transparent 62%);
  opacity: 0.45;
  pointer-events:none;
}

#follone-widget .tickerTop,
#follone-widget .tickerBot{
  position: relative;
  font-family: var(--font-dot-ticker);
  font-variant-numeric: tabular-nums;
  letter-spacing: var(--letter-dot);
  text-transform: uppercase;
  line-height: 1.1;
  user-select: none;
  text-rendering: optimizeSpeed;
}

#follone-widget .tickerTop{
  font-weight: 900;
  font-size: var(--fs-ticker-top);
  color: rgba(42,39,35,0.92);
  text-shadow: 0 1px 0 rgba(255,255,255,0.55);
}

#follone-widget .tickerBot{
  margin-top: 4px;
  font-weight: 800;
  font-size: var(--fs-ticker-bottom);
  color: rgba(42,39,35,0.70);
}

/* glitch pulse (soft) */
#follone-widget #follone-taskbar.glitch::before{ opacity: 0.95; filter: saturate(1.02); }
#follone-widget #follone-taskbar.glitch .tickerTop,
#follone-widget #follone-taskbar.glitch .tickerBot{ filter: blur(0.12px); transform: translateY(0.1px); }

/* ---- Actions ---- */
#follone-widget .actions{ margin-top: 10px; }

#follone-widget .xpLine{
  display:grid;
  grid-template-columns: auto auto 1fr;
  align-items:center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 14px;
  background: rgba(255,255,255,0.42);
  border: 1px solid rgba(42,39,35,0.10);
  box-shadow: var(--bevel);
}

#follone-widget .xpLabel,
#follone-widget .xpNext{
  font-family: var(--font-dot-ui);
  font-size: 11px;
  color: rgba(42,39,35,0.70);
  font-weight: 900;
  letter-spacing: 0.02em;
}

#follone-widget .xpBarWrap{
  height: 12px;
  border-radius: 8px;
  background: rgba(42,39,35,0.06);
  border: 1px solid rgba(42,39,35,0.10);
  overflow:hidden;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.55);
  position: relative;
}

/* Soft hint for XP track (no block grid) */
#follone-widget .xpBarWrap::before{
  content:"";
  position:absolute;
  inset: 1px;
  border-radius: 6px;
  background:
    linear-gradient(90deg, rgba(255,255,255,0.55), rgba(255,255,255,0.12));
  opacity: 0.22;
  pointer-events:none;
}

#follone-widget .xpBar{
  height:100%;
  width:0%;
  position: relative;
  background:
    radial-gradient(220px 20px at 10% 50%, rgba(255,255,255,0.45), transparent 70%),
    linear-gradient(90deg, var(--ui-accent-soft), var(--ui-accent));
  animation: folloneGlowSweep 1.4s var(--ease-out) infinite;
  transition: width var(--t-mid) var(--ease-out);
}

@keyframes folloneGlowSweep{
  0%{ filter: brightness(1.00); }
  50%{ filter: brightness(1.07); }
  100%{ filter: brightness(1.00); }
}

/* Boot sequence for XP line */
#follone-widget.booting .xpBar{
  transform-origin: left;
  animation: folloneBootSweep 680ms var(--ease-out) both, folloneStripe 1.2s linear infinite;
}

#follone-widget .actionBtn{
  width: 100%;
  margin-top: 8px;
  border-radius: 16px;
  border: 1px solid rgba(42,39,35,0.12);
  background: rgba(255,255,255,0.60);
  color: var(--ui-ink-0);
  padding: 10px 12px;
  font-size: 12px;
  font-weight: 900;
  cursor:pointer;
  box-shadow: 0 10px 26px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.82);
  transition: transform var(--t-fast) var(--ease-out), filter var(--t-fast) var(--ease-out);
}

#follone-widget .actionBtn:hover{ filter: brightness(1.03); transform: translateY(-1px); }
#follone-widget .actionBtn:active{ transform: translateY(0px); }

#follone-widget .muted{ margin-top: 8px; color: rgba(58,49,66,0.62); font-size: 11px; }

/* hide text-heavy quests on overlay (kept for internal logic) */
#follone-widget .quests{ display:none; }

/* ---- State tuning (no CRT textures) ---- */
#follone-widget[data-state="standby"]{ --glass-opacity: 0.40; }
#follone-widget[data-state="collecting"]{ --glass-opacity: 0.44; }
#follone-widget[data-state="classifying"]{ --glass-opacity: 0.48; }
#follone-widget[data-state="spotlight"]{ --glass-opacity: 0.52; }
#follone-widget[data-state="error"]{ --glass-opacity: 0.40; }

/* ---- Motion hooks ---- */
@keyframes folloneBreath { 0%,100% { filter: brightness(1); } 50% { filter: brightness(1.04); } }
@keyframes folloneScan {
  0% { background-position: 0px 0px; }
  100% { background-position: 60px 0px; }
}

#follone-widget[data-state="standby"] #follone-taskbar.ticker{
  animation: folloneBreath 2.4s ease-in-out infinite;
}
#follone-widget[data-state="classifying"] #follone-taskbar.ticker::before{ animation: none; }
#follone-widget[data-state="spotlight"] #follone-taskbar.ticker{
  /* stronger presence during spotlight */
  animation: folloneBreath 1.2s ease-in-out infinite;
  border-color: rgba(224, 58, 58, 0.35);
  box-shadow: 0 10px 26px rgba(0,0,0,0.14), 0 0 0 1px rgba(224, 58, 58, 0.16);
}

@keyframes folloneWarnBlink {
  0%, 49% { filter: brightness(1); }
  50%, 100% { filter: brightness(1.18); }
}

/* severity-driven warning while spotlight is open */
#follone-widget[data-state="spotlight"][data-alert="high"] #follone-taskbar.ticker,
#follone-widget[data-state="spotlight"][data-alert="3"] #follone-taskbar.ticker,
#follone-widget[data-state="spotlight"][data-alert="2"] #follone-taskbar.ticker{
  animation: folloneWarnBlink 900ms steps(2, end) infinite;
}
#follone-widget[data-state="error"] #follone-taskbar.ticker{
  animation: none;
}
#follone-widget[data-state="cooldown"] #follone-taskbar.ticker::before{ animation: none; }

/* reduce harshness for overlay/backdrop */
#follone-overlay, #follone-spotlight-overlay{
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", sans-serif;
}

/* ------------------------------------------------------------------
   Spotlight intervention overlay (veil + popover)
   NOTE: Content script injects #follone-spotlight
------------------------------------------------------------------ */

#follone-spotlight{
  position: fixed;
  inset: 0;
  z-index: 2147483646;
  display: none;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", sans-serif;
}

#follone-spotlight.show{ display:block; }

/* target emphasis */
.follone-spotlight-target{
  outline: 2px solid rgba(224, 58, 58, 0.55);
  outline-offset: 2px;
  border-radius: 16px;
  box-shadow: 0 0 0 6px rgba(224, 58, 58, 0.16);
}

.follone-spotlight-target .follone-target-badge{
  position: absolute;
  left: 10px;
  top: 10px;
  z-index: 2;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(246,241,234,0.92);
  border: 1px solid rgba(224,58,58,0.38);
  color: rgba(42,39,35,0.9);
  font-family: var(--font-dot-ui, ui-monospace, monospace);
  font-size: 11px;
  letter-spacing: 0.06em;
  box-shadow: 0 12px 28px rgba(0,0,0,0.18);
}

/* veil slices */
#follone-spotlight .veil{
  position: fixed;
  background: rgba(0,0,0,0.48);
  backdrop-filter: blur(1.5px);
}

/* popover */
#follone-spotlight .popover{
  position: fixed;
  width: 360px;
  max-width: min(420px, calc(100vw - 24px));
  background: rgba(255,255,255,0.92);
  border: 1px solid rgba(123,97,255,0.18);
  border-radius: 18px;
  box-shadow: 0 26px 60px rgba(0,0,0,0.22);
  overflow: hidden;
}

#follone-spotlight .popover::before{
  /* yume-kawa glass (no scanlines) */
  content:"";
  position:absolute; inset:0;
  pointer-events:none;
  background:
    radial-gradient(220px 140px at 16% 6%, rgba(255,255,255,0.46), transparent 72%),
    radial-gradient(260px 180px at 88% 10%, rgba(255,255,255,0.38), transparent 76%),
    radial-gradient(220px 160px at 30% 96%, rgba(123,97,255,0.10), transparent 72%),
    radial-gradient(220px 160px at 86% 86%, rgba(253,107,152,0.10), transparent 72%);
  opacity: 0.42;
}

#follone-spotlight .ph{
  display:flex;
  align-items:center;
  gap: 10px;
  padding: 12px 12px;
  border-bottom: 1px solid rgba(42,39,35,0.10);
  position: relative;
}

#follone-spotlight .ph .avatar{
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: rgba(0,0,0,0.08);
  overflow:hidden;
}

#follone-spotlight .ph .headText{ min-width:0; }
#follone-spotlight .ph .title{ font-weight: 900; font-size: 13px; color: rgba(42,39,35,0.92); letter-spacing: 0.04em; }
#follone-spotlight .ph .sub{ font-size: 11px; color: rgba(42,39,35,0.60); letter-spacing: 0.08em; }

#follone-spotlight .ph .badge{
  margin-left: auto;
  padding: 6px 10px;
  border-radius: 999px;
  font-family: var(--font-dot-ui, ui-monospace, monospace);
  font-size: 11px;
  letter-spacing: 0.08em;
  border: 1px solid rgba(42,39,35,0.16);
  background: rgba(255,255,255,0.6);
}

#follone-spotlight .pb{ padding: 12px 14px; }
#follone-spotlight .pb #follone-sp-text{ font-size: 13px; line-height: 1.55; color: rgba(42,39,35,0.92); }
#follone-spotlight .pb .muted{ color: rgba(42,39,35,0.68); font-size: 11px; }

#follone-spotlight .actions{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 12px 12px 14px; }
#follone-spotlight .actions button{
  border-radius: 14px;
  border: 1px solid rgba(42,39,35,0.14);
  background: rgba(255,255,255,0.72);
  color: rgba(42,39,35,0.92);
  padding: 10px 12px;
  font-weight: 900;
  cursor:pointer;
  box-shadow: 0 10px 24px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.75);
  transition: transform 120ms cubic-bezier(.16,1,.3,1), filter 120ms cubic-bezier(.16,1,.3,1);
}
#follone-spotlight .actions button:hover{ transform: translateY(-1px); filter: brightness(1.02); }
#follone-spotlight .actions button:active{ transform: translateY(0px) scale(0.99); }

/* Primary CTA: “検索へ” (widen perspective) */
#follone-spotlight .actions #follone-sp-search{
  border-color: rgba(126,66,255,0.28);
  background: linear-gradient(180deg, rgba(255,255,255,0.88), rgba(250,245,255,0.78));
  box-shadow: 0 14px 30px rgba(126,66,255,0.18), 0 10px 24px rgba(0,0,0,0.10), inset 0 1px 0 rgba(255,255,255,0.85);
}
#follone-spotlight .actions #follone-sp-search:hover{ filter: brightness(1.03) saturate(1.02); }

/* Secondary: “戻る” */
#follone-spotlight .actions #follone-sp-back{ background: rgba(255,255,255,0.62); }

/* Destructive-ish: “続ける” keeps neutral */
#follone-spotlight .actions #follone-sp-continue{ background: rgba(255,255,255,0.70); }

/* Strong warning styling */
@keyframes spWarnPulse { 0%,49%{ box-shadow: 0 26px 60px rgba(0,0,0,0.22), 0 0 0 1px rgba(224,58,58,0.22);} 50%,100%{ box-shadow: 0 30px 70px rgba(0,0,0,0.26), 0 0 0 2px rgba(224,58,58,0.36);} }
@keyframes spWarnStripe { 0%{ background-position: 0 0; } 100%{ background-position: 44px 0; } }
@keyframes spWarnVeil { 0%,49%{ opacity: 1; } 50%,100%{ opacity: 0.86; } }

#follone-spotlight[data-severity="high"] .popover,
#follone-spotlight[data-severity="3"] .popover,
#follone-spotlight[data-severity="2"] .popover{
  border-color: rgba(224,58,58,0.55);
  animation: spWarnPulse 900ms steps(2, end) infinite;
}

#follone-spotlight[data-severity="high"] .ph::after,
#follone-spotlight[data-severity="3"] .ph::after,
#follone-spotlight[data-severity="2"] .ph::after{
  content:"";
  position:absolute;
  left:0; right:0; top:0;
  height: 8px;
  background: repeating-linear-gradient(135deg, rgba(224,58,58,0.88) 0px, rgba(224,58,58,0.88) 10px, rgba(255,255,255,0) 10px, rgba(255,255,255,0) 20px);
  opacity: 0.55;
  animation: spWarnStripe 900ms linear infinite;
}

#follone-spotlight[data-severity="high"] .ph .badge,
#follone-spotlight[data-severity="3"] .ph .badge{
  border-color: rgba(224,58,58,0.55);
  background: rgba(224,58,58,0.12);
  color: rgba(140,14,14,0.95);
}

#follone-spotlight[data-severity="2"] .ph .badge{
  border-color: rgba(224,124,58,0.50);
  background: rgba(224,124,58,0.12);
  color: rgba(110,52,10,0.95);
}

#follone-spotlight[data-severity="high"] .veil,
#follone-spotlight[data-severity="3"] .veil{
  background: rgba(0,0,0,0.58);
  animation: spWarnVeil 900ms steps(2, end) infinite;
}


/* === M8E: Stronger spotlight contrast + ticker emphasis === */

/* Ticker goes "ALERT" mode with higher contrast */
#follone-widget[data-state="spotlight"] #follone-taskbar.ticker{
  background: rgba(224, 58, 58, 0.10);
  border-color: rgba(224, 58, 58, 0.52);
  box-shadow: 0 14px 34px rgba(0,0,0,0.18), 0 0 0 2px rgba(224, 58, 58, 0.16);
}

#follone-widget[data-state="spotlight"][data-alert="3"] #follone-taskbar.ticker,
#follone-widget[data-state="spotlight"][data-alert="high"] #follone-taskbar.ticker{
  background: rgba(224, 58, 58, 0.18);
  border-color: rgba(224, 58, 58, 0.78);
}

/* Spotlight popover: make the danger unmistakable */
#follone-spotlight[data-severity="3"] .popover,
#follone-spotlight[data-severity="high"] .popover{
  background: rgba(255, 236, 236, 0.98);
  border: 2px solid rgba(224,58,58,0.85);
  box-shadow: 0 34px 84px rgba(0,0,0,0.34), 0 0 0 2px rgba(224,58,58,0.22);
}

#follone-spotlight[data-severity="2"] .popover{
  background: rgba(255, 244, 236, 0.98);
  border: 2px solid rgba(224,124,58,0.80);
  box-shadow: 0 30px 76px rgba(0,0,0,0.30), 0 0 0 2px rgba(224,124,58,0.18);
}

#follone-spotlight[data-severity="3"] .ph,
#follone-spotlight[data-severity="high"] .ph{
  background: linear-gradient(180deg, rgba(224,58,58,0.18), rgba(255,255,255,0));
}
#follone-spotlight[data-severity="2"] .ph{
  background: linear-gradient(180deg, rgba(224,124,58,0.16), rgba(255,255,255,0));
}

/* Buttons: primary action looks like "escape" */
#follone-spotlight[data-severity="3"] .actions button,
#follone-spotlight[data-severity="high"] .actions button{
  border-color: rgba(224,58,58,0.55);
}
#follone-spotlight[data-severity="3"] .actions button.primary,
#follone-spotlight[data-severity="high"] .actions button.primary{
  background: rgba(224,58,58,0.18);
  border-color: rgba(224,58,58,0.85);
}

/* If content script didn't add .primary, still make the first button more prominent */
#follone-spotlight[data-severity="3"] .actions button:first-child,
#follone-spotlight[data-severity="high"] .actions button:first-child{
  background: rgba(224,58,58,0.16);
  border-color: rgba(224,58,58,0.80);
}

/* Post target outline stronger during high severity */
#follone-spotlight[data-severity="3"] .follone-spotlight-target,
#follone-spotlight[data-severity="high"] .follone-spotlight-target{
  outline-color: rgba(224, 58, 58, 0.88);
  box-shadow: 0 0 0 10px rgba(224, 58, 58, 0.22), 0 0 60px rgba(224,58,58,0.18);
}


/* === M8E: Stronger spotlight contrast + ticker emphasis === */

/* Ticker goes "ALERT" mode with higher contrast */
#follone-widget[data-state="spotlight"] #follone-taskbar.ticker{
  background: rgba(224, 58, 58, 0.10);
  border-color: rgba(224, 58, 58, 0.52);
  box-shadow: 0 14px 34px rgba(0,0,0,0.18), 0 0 0 2px rgba(224, 58, 58, 0.16);
}

#follone-widget[data-state="spotlight"][data-alert="3"] #follone-taskbar.ticker,
#follone-widget[data-state="spotlight"][data-alert="2"] #follone-taskbar.ticker{
  background: rgba(224, 58, 58, 0.16);
  border-color: rgba(224, 58, 58, 0.72);
}

#follone-widget[data-state="spotlight"][data-alert="3"] #follone-status-top,
#follone-widget[data-state="spotlight"][data-alert="2"] #follone-status-top{
  color: rgba(140, 14, 14, 0.95);
  font-weight: 1000;
}

/* Spotlight popover: make it visually "danger" and obvious */
#follone-spotlight[data-severity="3"] .popover,
#follone-spotlight[data-severity="2"] .popover{
  background: rgba(255, 236, 236, 0.98);
  border-color: rgba(224, 58, 58, 0.72);
  box-shadow: 0 34px 84px rgba(0,0,0,0.34), 0 0 0 3px rgba(224,58,58,0.22);
}

#follone-spotlight[data-severity="3"] .ph,
#follone-spotlight[data-severity="2"] .ph{
  border-bottom-color: rgba(224, 58, 58, 0.22);
  background: linear-gradient(180deg, rgba(224,58,58,0.14), rgba(255,255,255,0));
}

#follone-spotlight[data-severity="3"] .ph .title,
#follone-spotlight[data-severity="2"] .ph .title{
  color: rgba(120, 10, 10, 0.95);
}

#follone-spotlight[data-severity="3"] .actions button.primary,
#follone-spotlight[data-severity="2"] .actions button.primary{
  background: rgba(224, 58, 58, 0.16);
  border-color: rgba(224, 58, 58, 0.55);
}

#follone-spotlight[data-severity="3"] .actions button.primary:hover,
#follone-spotlight[data-severity="2"] .actions button.primary:hover{
  filter: brightness(1.06);
}

/* Stronger target outline */
#follone-spotlight[data-severity="3"] .follone-spotlight-target,
#follone-spotlight[data-severity="2"] .follone-spotlight-target{
  outline: 3px solid rgba(224, 58, 58, 0.78);
  box-shadow: 0 0 0 8px rgba(224, 58, 58, 0.22), 0 18px 64px rgba(224,58,58,0.14);
}


/* --- Strong warning palette for spotlight actions (ids-based) --- */
@keyframes folloneSpotPulse {
  0% { box-shadow: 0 26px 60px rgba(0,0,0,0.22), 0 0 0 0 rgba(224,58,58,0.0); }
  60% { box-shadow: 0 28px 66px rgba(0,0,0,0.24), 0 0 0 10px rgba(224,58,58,0.10); }
  100% { box-shadow: 0 26px 60px rgba(0,0,0,0.22), 0 0 0 0 rgba(224,58,58,0.0); }
}

#follone-spotlight[data-severity="3"] .popover,
#follone-spotlight[data-severity="2"] .popover{
  border: 2px solid rgba(224,58,58,0.46);
  background: rgba(255,244,244,0.96);
  animation: folloneSpotPulse 1.4s ease-in-out infinite;
}

#follone-spotlight[data-severity="3"] .badge,
#follone-spotlight[data-severity="2"] .badge{
  background: rgba(224,58,58,0.16);
  border-color: rgba(224,58,58,0.52);
  color: rgba(120,10,10,0.95);
}

#follone-spotlight[data-severity="3"] .actions #follone-sp-search,
#follone-spotlight[data-severity="3"] .actions #follone-sp-continue,
#follone-spotlight[data-severity="2"] .actions #follone-sp-search,
#follone-spotlight[data-severity="2"] .actions #follone-sp-continue{
  background: rgba(224,58,58,0.22);
  border-color: rgba(224,58,58,0.62);
  color: rgba(86, 8, 8, 0.96);
}

#follone-spotlight[data-severity="3"] .actions #follone-sp-search:hover,
#follone-spotlight[data-severity="3"] .actions #follone-sp-continue:hover,
#follone-spotlight[data-severity="2"] .actions #follone-sp-search:hover,
#follone-spotlight[data-severity="2"] .actions #follone-sp-continue:hover{
  filter: brightness(1.06);
}

/* Widget ticker: more obvious "SPOT" mode */
#follone-widget[data-state="spotlight"] #follone-taskbar .line1{
  font-weight: 800;
  letter-spacing: 0.10em;
}
#follone-widget[data-state="spotlight"] #follone-taskbar .line2{
  opacity: 0.92;
}


/* ------------------------------------------------------------
   Fullscreen Loader (startup / navigation)
   NOTE: DOM is created in content.js (#follone-loader). CSS was
   missing in dot-ui refactor; without this loader is invisible.
------------------------------------------------------------ */
#follone-loader{
  position: fixed;
  inset: 0;
  z-index: 2147483646; /* just under widget (widget is 2147483647) */
  /* Fallback tokens (loader lives outside #follone-widget scope) */
  --ui-accent: #7B61FF;
  --ui-accent-glow: rgba(123,97,255,0.22);
  --font-dot-ui: "DotGothic16", "Dot Gothic 16", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  --font-dot-ticker: "DotGothic16", "Dot Gothic 16", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  --t-mid: 220ms;
  --ease-out: cubic-bezier(.16,1,.3,1);
  display: grid;
  place-items: center;
  pointer-events: none;
  opacity: 0;
  transform: translateZ(0);
  transition: opacity var(--t-mid) var(--ease-out);
}
#follone-loader.show{
  pointer-events: auto;
  opacity: 1;
}

#follone-loader::before{
  /* Soft veil (yume-kawa). No scanlines / no CRT texture. */
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(1200px 680px at 50% 30%, rgba(255,255,255,0.70), rgba(255,255,255,0.35) 62%, rgba(0,0,0,0.08) 100%),
    radial-gradient(620px 420px at 18% 16%, rgba(123,97,255,0.18), transparent 72%),
    radial-gradient(620px 420px at 86% 18%, rgba(253,107,152,0.16), transparent 72%);
  opacity: 0.92;
}

#follone-loader .box{
  position: relative;
  width: min(520px, calc(100vw - 48px));
  border-radius: 22px;
  padding: 18px 18px 16px;
  background:
    linear-gradient(180deg, rgba(255,255,255,0.94), rgba(247,244,255,0.86));
  border: 1px solid rgba(123,97,255,0.18);
  box-shadow:
    0 24px 70px rgba(0,0,0,0.24),
    inset 0 1px 0 rgba(255,255,255,0.60);
  overflow: hidden;
}


#follone-loader.ready .box{
  transform: translateZ(0) scale(1.01);
  box-shadow:
    0 28px 80px rgba(0,0,0,0.26),
    0 0 0 2px rgba(123,97,255,0.14),
    inset 0 1px 0 rgba(255,255,255,0.65);
}
#follone-loader.ready .brand{ color: rgba(42,39,35,0.92); text-shadow: 0 1px 0 rgba(255,255,255,0.60), 0 0 24px rgba(123,97,255,0.18); }
#follone-loader .box::after{
  /* soft paper sheen (no dot grid) */
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(220px 140px at 18% 10%, rgba(255,255,255,0.55), transparent 70%),
    radial-gradient(260px 160px at 90% 16%, rgba(255,255,255,0.40), transparent 74%),
    linear-gradient(180deg, rgba(255,255,255,0.10), rgba(0,0,0,0.04));
  opacity: 0.55;
  pointer-events:none;
}

#follone-loader .brand{
  position: relative;
  font-family: var(--font-dot-ticker);
  letter-spacing: 0.10em;
  font-size: 22px;
  font-weight: 900;
  color: rgba(58,49,66,0.92);
  text-shadow: 0 1px 0 rgba(255,255,255,0.70), 0 0 22px rgba(123,97,255,0.18);
  margin-bottom: 4px;
}

#follone-loader .brand .ch{
  display:inline-block;
  animation: folloneLoaderCh 680ms steps(2,end) infinite;
}
@keyframes folloneLoaderCh{
  0%{ opacity: 0.35; filter: blur(0px); }
  50%{ opacity: 1; }
  100%{ opacity: 0.55; }
}

#follone-loader .subtitle{
  position: relative;
  font-family: var(--font-dot-ui);
  font-size: 12px;
  letter-spacing: 0.08em;
  color: rgba(58,49,66,0.78);
}

#follone-loader .quote{
  position: relative;
  margin-top: 8px;
  font-family: var(--font-dot-ui);
  font-size: 12px;
  color: rgba(58,49,66,0.82);
  opacity: 0.95;
}

/* Progress gauge (soft glass) */
#follone-loader .progressWrap{
  position: relative;
  margin-top: 14px;
  height: 14px;
  border-radius: 10px;
  background: rgba(255,255,255,0.62);
  border: 1px solid rgba(123,97,255,0.16);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.70),
    inset 0 -1px 0 rgba(0,0,0,0.06);
  overflow: hidden;
}

#follone-loader .progressWrap::before{
  /* subtle ticks */
  content:"";
  position:absolute; inset:0;
  background:
    repeating-linear-gradient(90deg,
      rgba(255,255,255,0.00) 0px,
      rgba(255,255,255,0.00) 10px,
      rgba(58,49,66,0.10) 10px,
      rgba(58,49,66,0.10) 12px);
  opacity: 0.38;
  mix-blend-mode: normal;
  pointer-events:none;
}

#follone-loader .progressBar{
  position:absolute; left:0; top:0; bottom:0;
  width: 0%;
  border-radius: 10px;
  background:
    linear-gradient(90deg,
      rgba(123,97,255,0.28),
      rgba(184,171,255,0.44),
      rgba(253,107,152,0.22));
  box-shadow:
    0 0 0 1px rgba(42,39,35,0.10) inset,
    0 0 24px var(--ui-accent-glow);
  animation: none;
}

#follone-loader .meta{
  position: relative;
  display:flex;
  justify-content: space-between;
  gap: 10px;
  margin-top: 10px;
}

#follone-loader .pill{
  font-family: var(--font-dot-ui);
  font-size: 11px;
  letter-spacing: 0.08em;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.68);
  border: 1px solid rgba(123,97,255,0.14);
  color: rgba(58,49,66,0.74);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.55);
}

/* Loader: spotlight-like emphasis (optional) */
#follone-loader.show .box{
  outline: 2px solid rgba(123,97,255,0.10);
}

/* -------------------------------------------------
   Timeline post analysis status badge (Phase 15+)
   - Always visible (DONE), fixed at top-right
   ------------------------------------------------- */

.follone-postBadge{
  position:absolute;
  top: 8px;
  right: 10px;
  z-index: 9999;
  pointer-events:none;
  display:flex;
  align-items:center;
  gap:6px;
  padding: 5px 9px;
  border-radius: 999px;
  font-family: var(--font-dot-ui);
  font-size: 11px;
  letter-spacing: 0.12em;
  color: rgba(42,39,35,0.78);
  background: rgba(255,255,255,0.70);
  border: 1px solid rgba(42,39,35,0.16);
  box-shadow: 0 10px 30px rgba(18,10,26,0.14), inset 0 1px 0 rgba(255,255,255,0.72);
  backdrop-filter: blur(10px);
}

.follone-postBadge .dot{
  width: 7px;
  height: 7px;
  border-radius: 999px;
  background: rgba(120, 92, 160, 0.65);
  box-shadow: 0 0 0 2px rgba(120, 92, 160, 0.20);
}

.follone-postBadge[data-state="analyzing"]{
  color: rgba(42,39,35,0.82);
}
.follone-postBadge[data-state="analyzing"] .dot{
  animation: folloneBadgePulse 1.1s infinite ease-in-out;
}

.follone-postBadge[data-state="done"]{
  opacity: 0.92;
}
.follone-postBadge[data-state="done"] .dot{
  background: rgba(92, 160, 132, 0.68);
  box-shadow: 0 0 0 2px rgba(92, 160, 132, 0.22);
}

@keyframes folloneBadgePulse{
  0%{ transform: scale(1); opacity: 0.6; }
  50%{ transform: scale(1.25); opacity: 1; }
  100%{ transform: scale(1); opacity: 0.6; }
}


/* -----------------------------
   Phase25-C: Post status chip (top-right)
----------------------------- */
.cansee-post-chip{
  position:absolute;
  top:10px;
  right:10px;
  z-index:99999;
  padding:3px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:700;
  line-height:1.3;
  letter-spacing:.02em;
  font-family: "DotGothic16","Dot Gothic 16",system-ui,-apple-system,"Segoe UI","Noto Sans JP",sans-serif;
  background: rgba(255,255,255,0.78);
  color: rgba(30,28,34,0.92);
  border: 1px solid rgba(0,0,0,0.18);
  box-shadow: 0 8px 18px rgba(0,0,0,0.08);
  backdrop-filter: blur(6px);
}
.cansee-post-chip[data-kind="queued"]{ border-color: rgba(123,97,255,0.35); }
.cansee-post-chip[data-kind="running"]{ border-color: rgba(123,97,255,0.55); }
.cansee-post-chip[data-kind="done"]{ border-color: rgba(46,204,113,0.5); }
.cansee-post-chip[data-kind="retry"]{ border-color: rgba(241,196,15,0.65); }
.cansee-post-chip[data-kind="recovering"]{ border-color: rgba(52,152,219,0.55); }
.cansee-post-chip[data-kind="error"]{ border-color: rgba(231,76,60,0.65); }


/* === Phase28-E Demo Hint (5秒でわかる導線) === */

#cansee-demo-hint{
  position: fixed;
  right: 18px;
  bottom: 92px;
  z-index: 2147483647;
  max-width: 320px;
  padding: 10px 12px;
  border-radius: 16px;
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(0,0,0,.06);
  box-shadow: 0 14px 36px rgba(0,0,0,.12);
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  color: #222;
  line-height: 1.5;
  backdrop-filter: blur(10px);
  animation: canseeHintIn .55s ease both;
}
#cansee-demo-hint .h-title{font-weight:900;font-size:12.5px;margin-bottom:2px}
#cansee-demo-hint .h-body{font-size:12.5px;color:#333}
#cansee-demo-hint .h-sub{font-size:11.5px;color:#666;margin-top:6px}
#cansee-demo-hint .h-chip{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(255,209,232,.55);font-weight:800;font-size:11px;margin-right:6px}
#cansee-demo-hint .h-x{position:absolute;top:8px;right:10px;border:0;background:transparent;font-size:14px;cursor:pointer;color:#999}
@keyframes canseeHintIn{from{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}


/* === Phase4: Daily limit popup (separate from overlay UI) === */
#follone-limitPopup{
  position: fixed;
  left: 50%;
  bottom: 22px;
  transform: translateX(-50%) translateY(12px);
  z-index: 2147483647;
  width: min(360px, calc(100vw - 24px));
  opacity: 0;
  pointer-events: none;
  transition: opacity 220ms ease, transform 220ms ease;
}
#follone-limitPopup.is-show{
  opacity: 1;
  transform: translateX(-50%) translateY(0);
  pointer-events: auto;
}
#follone-limitPopup .lp-card{
  border-radius: 18px;
  padding: 12px 12px 10px;
  background: rgba(255,255,255,0.86);
  border: 1px solid rgba(155,135,255,0.22);
  box-shadow: 0 18px 44px rgba(0,0,0,0.18);
  backdrop-filter: blur(12px);
}
:root[data-char="likoris"] #follone-limitPopup .lp-card{
  border-color: rgba(253,107,152,0.22);
}
#follone-limitPopup .lp-title{
  font-weight: 900;
  letter-spacing: .2px;
  font-size: 13px;
  margin-bottom: 4px;
  color: rgba(20,18,24,0.90);
}
#follone-limitPopup .lp-msg{
  font-size: 12.5px;
  line-height: 1.5;
  color: rgba(20,18,24,0.78);
}
#follone-limitPopup .lp-actions{
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  margin-top: 10px;
  flex-wrap: wrap;
}
#follone-limitPopup .lp-btn{
  cursor: pointer;
  border: 0;
  border-radius: 12px;
  padding: 8px 10px;
  font-weight: 900;
  font-size: 12px;
  background: rgba(155,135,255,0.92);
  color: #fff;
  box-shadow: 0 10px 26px rgba(155,135,255,0.22);
}
:root[data-char="likoris"] #follone-limitPopup .lp-btn{
  background: rgba(253,107,152,0.92);
  box-shadow: 0 10px 26px rgba(253,107,152,0.22);
}
#follone-limitPopup .lp-btn.lp-ghost{
  background: rgba(255,255,255,0.70);
  color: rgba(20,18,24,0.82);
  border: 1px solid rgba(0,0,0,0.12);
  box-shadow: none;
}
#follone-limitPopup .lp-btn:active{ transform: translateY(1px); }
